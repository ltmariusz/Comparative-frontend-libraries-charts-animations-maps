<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <title>Test Wydajności D3.js - Wykres Bąbelkowy</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <style>
        .bubble {
            fill-opacity: 0.7;
            stroke: black;
            stroke-width: 1;
        }

        .axis line,
        .axis path {
            stroke: black;
        }

        .axis text {
            font-family: sans-serif;
            font-size: 11px;
        }
    </style>
</head>

<body>

    <svg width="100%" height="500"></svg>
    <button id="btn10">10 bąbelków</button>
    <button id="btn100">100 bąbelków</button>
    <button id="btn1000">1000 bąbelków</button>
    <button id="btn10000">10000 bąbelków</button>

    <script>
        const svgWidth = window.innerWidth;
        const svgHeight = 500;
        const margin = { top: 20, right: 20, bottom: 30, left: 40 };
        const width = svgWidth - margin.left - margin.right;
        const height = svgHeight - margin.top - margin.bottom;

        const svg = d3.select("svg")
            .attr("width", svgWidth)
            .attr("height", svgHeight)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        const xScale = d3.scaleLinear().range([0, width]);
        const yScale = d3.scaleLinear().range([height, 0]);

        const xAxis = d3.axisBottom(xScale);
        const yAxis = d3.axisLeft(yScale);

        svg.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        svg.append("g")
            .attr("class", "axis axis--y")
            .call(yAxis);

        function generateData(count) {
            return d3.range(count).map(() => ({
                x: Math.random() * width,
                y: Math.random() * height,
                r: Math.random() * 40 // Promień bąbelka
            }));
        }

        function renderChart(data) {
            svg.selectAll(".bubble").remove(); // Usuń poprzednie bąbelki

            xScale.domain(d3.extent(data, d => d.x));
            yScale.domain(d3.extent(data, d => d.y));

            svg.select(".axis--x").call(xAxis);
            svg.select(".axis--y").call(yAxis);

            const bubbles = svg.selectAll(".bubble")
                .data(data)
                .enter().append("circle")
                .attr("class", "bubble")
                .attr("cx", d => xScale(d.x))
                .attr("cy", d => yScale(d.y))
                .attr("r", d => d.r);

            const startTime = performance.now();
            bubbles.transition().duration(2000); // Symulacja animacji
            const endTime = performance.now();
            console.log(`Czas renderowania wykresu: ${endTime - startTime} ms`);

            fetch('save_data.php', {
                method: 'POST',
                body: JSON.stringify({ endTime: endTime }),
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.text())
                .then(text => console.log(text))
                .catch(error => console.error('Błąd:', error));

        }
    
        document.getElementById('btn10').addEventListener('click', () => renderChart(generateData(10)));
        document.getElementById('btn100').addEventListener('click', () => renderChart(generateData(100)));
        document.getElementById('btn1000').addEventListener('click', () => renderChart(generateData(1000)));
        document.getElementById('btn10000').addEventListener('click', () => renderChart(generateData(10000)));
    </script>

</body>

</html>